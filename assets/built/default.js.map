{"version":3,"sources":["default.js"],"names":["$","window","toggleMenu","body","overlay","menu","data","css","addClass","removeClass","document","querySelectorAll","forEach","image","container","closest","ratio","attributes","width","value","height","style","flex","nabbers","url","img","createIgPost","postHtml","article","igContainer","append","initHomeBetweenPosts","tags","showNabbers","_igStart","_igPostsFactor","_igPostsBetween","igPostsFactor","igStart","igPostsBetween","nabberIndex","igPostIndex","getJSON","done","igPosts","length","_","filter","posts","post","find","tag","hashtags","hashtag","locationTags","locTag","toArray","card","i","arr","footerSponsors","clone","sponsorsContainer","after","singleSponsor","link","attr","createNabber","before","html","instgrm","Embeds","process","initRideWithGpsSwitcher","id","routes","setActiveButton","each","button","rideWithGps","name","click","buttonRoute","attachedIframe","routeToLoad","iframe","route","initTrailforksIframe","trailforksDiv","div","iframeWidth","Math","floor","iframeHeight","trailsBool","detailsBool","resizerScriptUrl","script","getScript","trailforksWidgetUrl","ready","fitVids","trailforksIds","iframeObj","trailforksId"],"mappings":"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","file":"default.js","sourcesContent":["$(function($) {\n  window.toggleMenu = function() {\n    var body = $('body');\n    var overlay = $('#mtbva-overlay');\n    var menu = $('#mtbva-menu');\n    if (menu.data('hidden')) {\n      menu.data('hidden', false);\n      body.css('overflow-y', 'hidden');\n      menu.addClass('mtbva-menu-open');\n      overlay.addClass('mtbva-overlay-active');\n    } else {\n      menu.data('hidden', true);\n      body.css('overflow-y', 'auto');\n      menu.removeClass('mtbva-menu-open');\n      overlay.removeClass('mtbva-overlay-active');\n    }\n  };\n\n  var images = document.querySelectorAll('.kg-gallery-image img');\n  images.forEach(function(image) {\n    var container = image.closest('.kg-gallery-image');\n    var width = image.attributes.width.value;\n    var height = image.attributes.height.value;\n    var ratio = width / height;\n    container.style.flex = ratio + ' 1 0%';\n  });\n\n  //TODO: make this work with 12 posts per page and multiple pages\n  var nabbers = [\n    {\n      url: 'https://viralstyle.com/store/angelo-wash/Sketchcollect',\n      img: '/content/images/sponsors/nabber/sketch-collect-banner.jpg'\n    },\n    {\n      url: 'https://www.visitroanokeva.com/',\n      img: '/content/images/sponsors/nabber/virginias-blue-ridge.jpg'\n    },\n    {\n      url: 'https://www.deschutesbrewery.com/',\n      img: '/content/images/sponsors/nabber/deschutes.jpg'\n    },\n    {\n      url: 'http://jackmasonstavern.com/',\n      img: '/content/images/sponsors/nabber/jack-masons-tavern.jpg'\n    }\n\n  ];\n\n  function createNabber(i) {\n    var singleSponsor = $('<div class=\"sponsor-single\">');\n    var link = $('<a>').attr('href', nabbers[i].url);\n    var img = $('<img>').attr('src', nabbers[i].img);\n    link.append(img);\n    singleSponsor.append(link);\n    return singleSponsor;\n  }\n\n  window.createIgPost = function(postHtml) {\n    var article = $('<article class=\"post-card ig-post-card\">');\n    var igContainer = $('<div class=\"ig-container\">');\n    igContainer.append(postHtml);\n    article.append(igContainer);\n    return article;\n  };\n\n  window.initHomeBetweenPosts = function(\n    tags,\n    showNabbers,\n    _igStart,\n    _igPostsFactor,\n    _igPostsBetween\n  ) {\n\n    var nabberFactor = 3;\n    var igPostsFactor = _igPostsFactor || 2;\n    var igStart = _igStart > -1 ? _igStart : 2;\n    var igPostsBetween = _igPostsBetween || 2;\n    var nabberIndex = 0;\n    var igPostIndex = 0;\n\n    $.getJSON('/content/images/data/instagram.json')\n      .done(function(data) {\n        var igPosts = [];\n        if (tags && tags.length) {\n          igPosts = _.filter(data.posts, function(post) {\n            return _.find(tags, function(tag) {\n              var hashtags = _.find(post.hashtags, function(hashtag) {\n                return hashtag === tag;\n              });\n              var locationTags = _.find(post.locationTags, function(locTag) {\n                return locTag === tag;\n              })\n              return hashtags || locationTags;\n            });\n          });\n        } else {\n          igPosts = data.posts;\n        }\n        $('.post-card')\n          .toArray()\n          .forEach(function(card, i, arr) {\n            if (i >= igStart) {\n              // Nabbers\n              if (showNabbers &&\n                i % nabberFactor === 0 &&\n                i < (nabbers.length * nabberFactor)) {\n\n                if (nabberIndex === 2 &&\n                  i === 6) {\n                  var footerSponsors = $.clone($('.sponsors-container')[0]);\n                  var sponsorsContainer = $('<div class=\"sponsors-middle mtbva-parallax\">');\n                  sponsorsContainer.append($(footerSponsors));\n                  $(card).after(sponsorsContainer);\n                } else {\n                  $(card).after(createNabber(nabberIndex));\n                  nabberIndex += 1;\n                }\n              }\n\n              // Instagram posts\n              function attachIgPost() {\n                if (i % igPostsFactor === 0 &&\n                  i < (igPosts.length * igPostsFactor) &&\n                  igPosts[igPostIndex]) {\n                  $(card).before(createIgPost(igPosts[igPostIndex].html));\n                  igPostIndex += 1;\n                }\n              }\n\n              for (var i = 0; i < igPostsBetween; i++) {\n                attachIgPost();\n              }\n            }\n          });\n\n        window.instgrm.Embeds.process();\n      });\n  };\n\n  window.initRideWithGpsSwitcher = function(id, routes) {\n    if (!window.rideWithGps) {\n      window.rideWithGps = {};\n    }\n    window.rideWithGps[id] = routes[0].name;\n    $('#' + id + ' button')\n      .each(function(i, button) {\n        $(button).click(function() {\n          var buttonRoute = $(button).attr('data-route');\n          if (window.rideWithGps[id] === buttonRoute) {\n            return;\n          }\n\n          $('#' + id + ' iframe').css('visibility', 'hidden');\n\n          var attachedIframe;\n          $('#' + id + ' iframe').toArray().forEach(function(iframe) {\n            if ($(iframe).attr('data-route') === buttonRoute) {\n              attachedIframe = iframe;\n              return;\n            }\n          });\n          if (attachedIframe) {\n            // iframe is already in the DOM\n            $(attachedIframe)\n              .css('display', 'block')\n              .css('visibility', 'visible');\n          } else {\n            // load new iframe into the DOM\n            var routeToLoad;\n            routes.forEach(function(route) {\n              if (route.name === buttonRoute) {\n                routeToLoad = route;\n                return;\n              }\n            });\n            $('#' + id).append(\n              $('<iframe>')\n                .attr('src', routeToLoad.url)\n                .attr('data-route', routeToLoad.name)\n            );\n          }\n\n          // update global object\n          window.rideWithGps[id] = buttonRoute;\n\n          // hide all the other iframes\n          $('#' + id + ' iframe').each(function(i, iframe) {\n            if ($(iframe).attr('data-route') !== buttonRoute) {\n              $(iframe).css('display', 'none');\n            }\n          });\n\n          setActiveButton();\n        });\n      });\n\n    setActiveButton();\n\n    function setActiveButton() {\n      $('#' + id + ' button').each(function(i, button) {\n        $(button).css('border', 'none');\n        if ($(button).attr('data-route') === window.rideWithGps[id]) {\n          $(button).css('border', '2px solid #3eb0ef');\n        }\n      });\n    }\n  };\n\n  window.initTrailforksIframe = function(id) {\n    var trailforksDiv = $('.TrailforksWidgetRoute')\n      .toArray()\n      .find(function(div) {\n          return $(div).attr('data-id') === id;\n        }\n      );\n    if (!trailforksDiv) {\n      return;\n    }\n    trailforksDiv = $(trailforksDiv);\n\n    var tabletBreak = 900;\n    var elevationHeightBreak = 500;\n    var iframeWidth = Math.floor($('.post-content').width()) - 20;\n    var iframeHeight = $(window).height();\n    var trailsBool = '0';\n    var detailsBool = '0';\n\n    var width = $(document).width();\n    if (width < tabletBreak) {\n      iframeHeight = Math.floor(iframeHeight * .6);\n      iframeWidth = Math.floor($('.post-content').width()) - 5;\n      if (iframeHeight < elevationHeightBreak) {\n        iframeHeight = elevationHeightBreak;\n      }\n    } else {\n      iframeHeight = Math.floor(iframeHeight * .8);\n      if (width > tabletBreak) {\n        trailsBool = '1';\n        detailsBool = '1';\n      }\n    }\n    // FIXME: TrailForks widget seems to be broken when using data-elevation=0\n    // if (iframeHeight < elevationHeightBreak) {\n    //   trailforksDiv.attr('data-elevation', '0');\n    // }\n    trailforksDiv.attr('data-trails', trailsBool);\n    trailforksDiv.attr('data-details', detailsBool);\n    trailforksDiv.attr('data-w', iframeWidth);\n    trailforksDiv.attr('data-h', iframeHeight);\n\n    var resizerScriptUrl = 'https://es.pinkbike.org/326/sprt/j/trailforks/iframeResizer.min.js';\n    var resizerScript = $('script').filter(function(script) {\n      return ($(script).attr('src') === resizerScriptUrl);\n    });\n    if (resizerScript.length === 0) {\n      $.getScript(resizerScriptUrl);\n    }\n    var trailforksWidgetUrl = 'https://es.pinkbike.org/ttl-86400/sprt/j/trailforks/widget.js';\n    var widgetScript = $('script').filter(function(script) {\n      return ($(script).attr('src') === trailforksWidgetUrl);\n    });\n    if (widgetScript.length === 0) {\n      $.getScript(trailforksWidgetUrl);\n    }\n  };\n\n  $(document).ready(function() {\n    $('.index-yt-container').fitVids();\n  });\n\n  // Start TrailForks\n  var routesWithTrailforksIframes = [\n    {\n      route: 'creature',\n      trailforksIds: [\n        '16397',\n        '16201',\n        '15691',\n        '15706'\n      ]\n    }\n  ];\n\n  routesWithTrailforksIframes.forEach(function(iframeObj) {\n    iframeObj.trailforksIds.forEach(function(trailforksId) {\n      window.initTrailforksIframe(trailforksId);\n    });\n  });\n  // End Trailforks\n});\n"]}